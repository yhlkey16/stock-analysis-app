# .github/workflows/main.yml

name: Daily News Collector

on:
  # è¨­å®šè§¸ç™¼æ¢ä»¶
  schedule:
    # ä½¿ç”¨ CRON èªæ³•ï¼Œè¨­å®šåœ¨æ¯å¤© UTC æ™‚é–“çš„ 00:00 åŸ·è¡Œ
    # é€™å¤§ç´„æ˜¯å°ç£æ™‚é–“çš„æ—©ä¸Š 8 é»
    - cron: '0 0 * * *'
  # å¢åŠ ä¸€å€‹æ‰‹å‹•è§¸ç™¼çš„é¸é …ï¼Œæ–¹ä¾¿æˆ‘å€‘æ¸¬è©¦
  workflow_dispatch:

jobs:
  build-and-run-collector:
    # æŒ‡å®šé‹è¡Œçš„ç’°å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ä¸€æ­¥ï¼šå°‡ä½ çš„ GitHub å€‰åº«ç¨‹å¼ç¢¼ä¸‹è¼‰åˆ°è™›æ“¬æ©Ÿä¸­
      - name: Check out repository
        uses: actions/checkout@v4

      # ç¬¬äºŒæ­¥ï¼šè¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # æŒ‡å®š Python ç‰ˆæœ¬

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£æ‰€æœ‰éœ€è¦çš„å‡½å¼åº«
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # ç¬¬å››æ­¥ï¼šåŸ·è¡Œæˆ‘å€‘çš„ collector.py è…³æœ¬
      - name: Run the news collector script
        # é—œéµï¼å°‡æˆ‘å€‘å„²å­˜åœ¨ GitHub Secrets çš„é‡‘é‘°ï¼Œè¨­å®šç‚ºç’°å¢ƒè®Šæ•¸
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        run: python collector.py

      # ç¬¬äº”æ­¥ï¼šå°‡ç”¢ç”Ÿå¥½çš„ news_analysis.csv æª”æ¡ˆå­˜å›å€‰åº«
      - name: Commit and push if changed
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          git add news_analysis.csv
          # æª¢æŸ¥æ˜¯å¦æœ‰æª”æ¡ˆè®Šå‹•
          git diff --staged --quiet || git commit -m "ğŸ“Š Automated daily news analysis update"
          git push